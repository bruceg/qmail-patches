<H1>Index of /~bruceg/qmail+patches</H1>

<p><b>qmail</b> is a secure, reliable, efficient, simple message
transfer agent.
It is meant as a replacement for the entire sendmail-binmail system on
typical Internet-connected UNIX hosts.
<a href="http://www.qmail.org/">Learn more about qmail.</a></p>

<p>This is (and will be) a source-only RPM of the main qmail package
with several patches from the above web page added.  This directory
contains all all the source files used to create the RPM.
<a href="http://www.rpm.org/">Learn more about RPM.</a>
The source rpm contains all of the other files in this directory.
</p>

<p><b>This package requires the following packages:</b>
<ul>
<li><a href="../supervise-scripts/">supervise-scripts</a> version 3.2
<li><a href="../rpms/daemontools/">daemontools</a> version 0.70
<li><a href="../rpms/ucspi-tcp/">ucspi-tcp</a> version 0.88
<li>rpm version 3.0 or later
<li>If you are going to use <tt>qmail-mailq</tt>, <a
href="../ucspi-unix/">ucspi-unix</a>
</ul>
Other packages recommended for efficient use of qmail are:
<ul>
<li><a href="../rpms/dot-forward/">dot-forward</a>
<li><a href="../rpms/rblsmtpd/">rblsmtpd</a>
-- A RBL blocking add-on for qmail-smtpd
<li><a href="../nullmailer/">nullmailer</a>
-- "Dumb" client software package which can deliver via either SMTP or QMQP
<li><a href="../vmailmgr/">vmailmgr</a>
-- Virtual mail domain manager for qmail
</ul></p>

<p><b><i><font size=+1>NOTE:</font></i>
Do NOT distribute binary packages built from this distribution!</b> 
Such packages are explicitly disallowed by the author of qmail, and
frustrating as it may be, I understand his reasoning.
This packaging of qmail comes with no warranties of any kind.
</p>

<p><b>Features of this package:</b>
<ul>
<li>Johannes Erdfelt's big-concurrency patch, which allows qmail-send to
spawn more than 255 processes.
<li>Russell Nelson's big-todo patch, which allows qmail to receive mail
much faster.
<li>A big-DNS patch, which allows qmail to work with sites that
have DNS responses that are larger than 512 bytes.
<li>Startup scripts set configurable limits on daemon's CPU time and
data size to avoid denial-of-service attacks.
<li>Integrated optional RBL blocking support from multiple servers.
<li>UID/GID numbers are configured into a set of control files instead
  of hard-coded in the binaries.  This would allow a binary RPM to be
  distributed unmodified to any setup.
<li>The qmail run script uses the contents of
  <samp>/etc/qmail/control/aliasempty</samp> for the aliasempty argument to
  qmail-start
<li>Message logging is done via the string in
  <samp>/etc/qmail/control/logger</samp>
<li>qmail-showctl shows the contents of all the control files used in
  this package
<li>Intelligent login scripts (<samp>/etc/profile.d/qmail.sh</samp> and
  <samp>/etc/profile.d/qmail.tcsh</samp>).
<li>A man page documenting the control files used by all the init scripts
<li>All the network daemons use tcpserver to manage connections
<li>Chuck Foster's patch to bind to local interfaces on outgoing
  connections, ported to qmail-1.03
<li>Evan Champion's patch to conredirect, ported to qmail-1.03
<li>A fix for broken CR/LF conventions on SMTP connections that doesn't
require a patch to qmail.
</ul></p>

<p><b>Changes in release 17:</b>
<ul>
<li>Modified for use with <a
href="../supervise-scripts/">supervise-scripts</a> 3.x.
<li>Merged all the subpackages into one main package.
<li>Added checkpassword to the package.
<li>Fixed the broken bind-interface patch.
<li>Fixed the synchronous directory add-on to properly only synchronize
the directory when files are being created (as opposed to whenever a
file was opened for write).
<li>Added a README describing the patches.
</ul></p>

<p><b>Changes in release 16:</b>
<ul>
<li>Fixed the broken paths in the run scripts.
<li>Integrated the "mailq" package into the main package.
<li>Fixed some semi-invalid tcpserver options.
</ul></p>

<p><b>Changes in release 15:</b>
<ul>
<li>Changed the default aliasempty to deliver to <tt>./Maildir/</tt>.
<li>The <tt>mailq</tt> program is now a client that access a pair of
local-domain servers, eliminating the need for a setuid <tt>mailq</tt>.
<li>Fixed another typo in the SMTP run file.
<li>Added nodelay options to the SMTP and POP3 servers.
<li>Added the no remote DNS lookup on the POP3 servers.
<li>Fixed datemail script.
<li>Changed the hourly cron job to only regenerate the qmail users CDB
file if it previously existed.
<li>The tcpserver run files now use envuidgid instead of the clunky
<tt>"`uid ...`"</tt> shell escapes.
<li>Changed the spec to only modify inetd.conf if it previously existed
(RH7.0 no longer has an inetd.conf).
<li>Allow for compressed man pages (to compensate for RPM's apparent new
default of silently compressing man pages before %files is processed).
<li>Use %{_bindir} and company instead of hard-coded paths, to be
compatible with both RH6.x and 7.x).
<li>The smtpd startup script uses the value of <tt>control/me</tt> as
the local host name, avoiding one DNS lookup on incoming connections.
<li>Added a <tt>qmail-reload</tt> command, that regenerates the
<tt>users</tt> and <tt>morercpthosts</tt> CDB files and HUP's
<tt>qmail-send</tt> to make it reload its <tt>locals</tt> and
<tt>virtualdomains</tt> files.
<li>Removed the completely non-functional SSL-wrapped POP3 support.
</ul></p>

<p><b>Changes in release 14:</b>
<ul>
<li>Added a support package for SSL-wrapped POP3.
<li>Moved all the binaries out of the daemon support packages.
<li>Fixed a problem in the spec file caused by RPM (or cpio?) clearing
the "sticky" bit when adding files to the RPM.
</ul></p>

<p><b>Changes in release 13:</b>
<ul>
<li>Fixed a bug in one of the patches that prevented the RPM from being
built when using a newer version of patch.
<li>Included the unused <tt>qmail-qmqpc</tt> program and man page in the
base package.
<li>Fixed a bug in the qmail-smtpd run script that caused it to not
handle the RBL timeout parameter properly.
</ul></p>

<p><b>Changes in release 12:</b>
<ul>
<li>Updated to use new rblsmtpd and fixcrio in ucspi-tcp version 0.86.
</ul></p>

<p><b>Changes in release 11:</b>
<ul>
<li>Added big-concurrency patch to allow for more than 255 remotes.
Note that you may need to patch your kernel and/or libraries if you want
this to be larger than 509 remotes.
<li>Fixed a bug in the init scripts that caused the log messages to go
to the console.
<li>Added a RedHat specific configuration script.
<li>Removed the qmail specific "hostname" program that conflicted with
program from net-tools of the same name.
</ul></p>

<p><b>Changes in release 10:</b>
<ul>
<li>Integrated with daemontools 0.61 and supervise-scripts 2.2
</ul></p>

<p><b>Changes in release 8:</b>
<ul>
<li>Added Russell Nelson's big-todo patch, which allows qmail to receive
mail faster.
<li>Added a big DNS patch, which allows qmail to work with sites that
have DNS responses that are larger than 512 bytes.
<li>Removed the whole qmail-utils/qmail-qmqpc mess.  If you want to run
a relay-only client, I would recommend <a
href="../nullmailer/">nullmailer</a> instead of qmail-qmqpc.
<li>The startup scripts now use my supervise scripts instead of having
their own copy of essentially the same thing.
</ul></p>

<p><b>Changes in release 7:</b>
<ul>
<li>Fixed (yes again) and verified the "ulimit" commands.
<li>Modified the start/stop init scripts to wait until the programs
actually shut down (or 15 seconds pass) before indicating completion.
<li>Set up an hourly cron job that will create/update
<samp>users/assign</samp> and <samp>users/cdb</samp>.
<li>Removed the rblsmtpd sub-package.
<li>Modified the smtpd init script to optionally call rblsmtpd and
antirbl if they are installed.
</ul></p>

<p><b>Changes in release 6:</b>
<ul>
<li>Fixed the "ulimit" commands in the pop3d, qmqpd, qmtpd, and smtpd
init scripts so that it is now possible to configure the processor and
memory limits on these daemons from the control directory.
<li>Moved qmail-showctl into the qmail-utils package, since users of
qmail-qmqpc may wish to see this information.
</ul></p>

<p><b>Changes in release 5:</b>
<ul>
<li>Added an alternative smtp server package with the rblsmtpd.
<li>Removed the newline patch in favour of using fixcr with the smtp
daemons.
<li>Removed the /var/log/* directories in favour of separate "config"
packages that set up logging via either cyclog or <a
href="../qlogtools/">qfilelog</a>.
<li>Fixed the install script so that the installation will not fail if
the special users and groups already exist.
<li>Added a patch to allow the various programs to call a different
program instead of qmail-queue by setting the QMAILQUEUE environment
variable.  This could be used in the smtp daemon to run a header
rewriter or to filter emails based on address patterns.
<li>Both the base qmail and qmail-qmqpc provide "qmail-queue" which is
required by the various daemons.
<li>The qmail-qmqpc package no longer uses the install-path patch.
</ul></p>

<p><b>Changes in release 4:</b>
<ul>
<li>Used a revised directory sync patch that catches all the possible
synchronization points.
<li>Added a patch to the qmqp client package that allows the server
connection timeout to be configured in
<samp>/etc/qmail/control/timeoutconnect</samp>, which defaults to 60
seconds instead of a hard-coded 10 second timeout (per server).
</ul></p>

<p><b>Changes in release 3:</b>
<ul>
<li>Added a patch to sync directories to make deliveries fully reliable.
<li>Moved the binaries from <samp>/usr/bin/qmail</samp> to
<samp>/usr/bin</samp>.
<li>Added a qmail-qmqpc null client package.
<li>Fixed bug in installation of the <samp>.qmail-msglog</samp> file.
<li>Added <samp>-R</samp> option to tcpserver in the qmqpd init script.
<li>Moved most of the user mail access utilities and associated files
into qmail-utils package, which is required by both the base qmail package
and the qmail-qmqpc package.
</ul></p>

<a href="mailto:bait@qcc.sk.ca"></a>
